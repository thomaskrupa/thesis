#Test case 283
# Data from Chen2016 (free case)

Data_1 <- matrix(c(85300,19581,66.1,31690,3464,
                   95288,20222,69.4,20386,2664,
                   58322,12801,59.7,16298,1950,
                   39078,11912,70.5,14884,1805,
                   15600,10451,49.4,13838,1296,
                   33365,9134,82.4,11336,1165,
                   35328,8450,50,10681,1150,
                   44536,9043.1,39.9,10582.9,1430.2,
                   46900,8197.5,54.9,8970.9,1277.9,
                   14000,5000,28.3,8600,215,
                   30800,6364.8,31.8,7919.4,610,
                   45404,5312.1,45.5,7582.3,956,
                   26757,5768,61.4,6389.5,408.1,
                   28905,5152.5,51.6,6054,825,
                   17881,3751,84.7,5410.6,541,
                   19700,4055,52.8,5409,1032,
                   15850,5223,69.9,5327,914,
                   27200,4154,108.5,4827.5,885.1,
                   24300,4106,83.8,4514,691,
                   15996,3773.8,46.9,3755.4,602.5,
                   19415,4269.6,46.9,3740.3,565.5,
                   20175,3272.2,59,3680,533.3,
                   20767,2921,33.9,3449.9,465.1,
                   13231,2725,54.3,3328.3,568.1,
                   13500,2607.7,71.7,3112.6,413.4,
                   17023,2928.1,57.3,2996.1,418.8,
                   14081,2617,66.8,2897.3,329,
                   13598,2379.4,52,2868,452.2,
                   4900,3007.8,41.1,2859.6,288.6,
                   11171,1265.1,60.7,2565.4,353.1),byrow=TRUE, nrow=30);


Input = matrix(c(85300,19581,
                 95288,20222,
                 58322,12801,
                 39078,11912,
                 15600,10451,
                 33365,9134,
                 35328,8450,
                 44536,9043.1,
                 46900,8197.5,
                 14000,5000,
                 30800,6364.8,
                 45404,5312.1,
                 26757,5768,
                 28905,5152.5,
                 17881,3751,
                 19700,4055,
                 15850,5223,
                 27200,4154,
                 24300,4106,
                 15996,3773.8,
                 19415,4269.6,
                 20175,3272.2,
                 20767,2921,
                 13231,2725,
                 13500,2607.7,
                 17023,2928.1,
                 14081,2617,
                 13598,2379.4,
                 4900,3007.8,
                 11171,1265.1),byrow=TRUE, nrow=30);

Output <- matrix(c(66.1,
                   69.4,
                   59.7,
                   70.5,
                   49.4,
                   82.4,
                   50,
                   39.9,
                   54.9,
                   28.3,
                   31.8,
                   45.5,
                   61.4,
                   51.6,
                   84.7,
                   52.8,
                   69.9,
                   108.5,
                   83.8,
                   46.9,
                   46.9,
                   59,
                   33.9,
                   54.3,
                   71.7,
                   57.3,
                   66.8,
                   52,
                   41.1,
                   60.7),byrow=TRUE, nrow=30);

Link <- matrix(c(31690,3464,
                 20386,2664,
                 16298,1950,
                 14884,1805,
                 13838,1296,
                 11336,1165,
                 10681,1150,
                 10582.9,1430.2,
                 8970.9,1277.9,
                 8600,215,
                 7919.4,610,
                 7582.3,956,
                 6389.5,408.1,
                 6054,825,
                 5410.6,541,
                 5409,1032,
                 5327,914,
                 4827.5,885.1,
                 4514,691,
                 3755.4,602.5,
                 3740.3,565.5,
                 3680,533.3,
                 3449.9,465.1,
                 3328.3,568.1,
                 3112.6,413.4,
                 2996.1,418.8,
                 2897.3,329,
                 2868,452.2,
                 2859.6,288.6,
                 2565.4,353.1),byrow=TRUE, nrow=30);


weights = matrix(c(1,0), byrow = TRUE, nrow = 1);

K = 2; # Amount of divisions
N = 30; # Amount of DMU's
sum_m = 2; # Amount of Inputs
sum_r = 1; # Amount of Outputs
sum_l = 2; # Amount of Links


Amount <- c(2,0,0,1,2);
Amount_Input = c(2,0);
Amount_Output = c(0,1);
Amount_Link = c(2);




direction = "input" ;
link_con = 2; #free
return_to_scale = "CRS"
NIRS <- 0;
Link_obj = 0; # No Link variable in the objective function



#Loading all the functioN:
setwd(getwd())
setwd("..")
setwd("00_pkg_src")
setwd("Nsbm.function")
setwd("R")
source("load_all_func.R");
load_all_func();
setwd("..")
setwd("..")
setwd("..")
setwd("tests")



test_that("Test case 283",{

  # Division efficiency
  DivEffNSBM <- matrix(c(0.0828,0,
                         0.0821,0,
                         0.1127,0,
                         0.1610,0,
                         0.1901,0,
                         0.2355,0,
                         0.1472,0,
                         0.1041,0,
                         0.1512,0,
                         0.1646,0,
                         0.1185,0,
                         0.1745,0,
                         0.2558,0,
                         0.2274,0,
                         0.5380,0,
                         0.3084,0,
                         0.3759,0,
                         0.5692,0,
                         0.4566,0,
                         0.3077,0,
                         0.2657,0,
                         0.3990,0,
                         0.2479,0,
                         0.4721,0,
                         0.6388,0,
                         0.4399,0,
                         0.5864,0,
                         0.4936,0,
                         0.5222,0,
                         1,0), byrow=TRUE, nrow=30);


  # Efficiency results
  EfficiencyNSBM <- matrix(c(0.0828,
                             0.0821,
                             0.1127,
                             0.1610,
                             0.1901,
                             0.2355,
                             0.1472,
                             0.1041,
                             0.1512,
                             0.1646,
                             0.1185,
                             0.1745,
                             0.2558,
                             0.2274,
                             0.5380,
                             0.3084,
                             0.3759,
                             0.5692,
                             0.4566,
                             0.3077,
                             0.2657,
                             0.3990,
                             0.2479,
                             0.4721,
                             0.6388,
                             0.4399,
                             0.5864,
                             0.4936,
                             0.5222,
                             1), byrow=TRUE, nrow=30);


  #########################################
  #########################################
  #########################################


  # Efficiency results
  expect_equal(round(nsbm(direction, return_to_scale, link_con, Data_1, Amount, K, weights, NIRS, Link_obj)$Eff,4), EfficiencyNSBM, check.attributes = FALSE)

  expect_equal(round(nsbm(direction, return_to_scale, link_con, Data_1, Amount, K, weights, NIRS, Link_obj)$divEff,4), DivEffNSBM, check.attributes = FALSE)

})
